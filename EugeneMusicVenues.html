<!--To create this site, I refrenced 'VersitileLayout.html', originally created by Andy Cochran,
From https://medium.com/nyc-planning-digital/a-versatile-layout-for-full-screen-maps-229cec508b22,
as well as the mapbox tutorial 'Build a venue Locator using Mapbox GL JS',
From https://docs.mapbox.com/help/tutorials/building-a-venue-locator/-->

<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="utf-8" />
        <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
        <title>Eugene Music Venues</title>
        <script src='https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.js'></script>
        <link href='https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.css' rel='stylesheet' />
        <style>
            body { margin:0; padding:0; }
            #map { position:absolute; top:0; bottom:0; width:100%; } 
            h1 { font-size: 22px; margin: 0; font-weight: 400; line-height: 20px; padding: 20px 2px; cursor: pointer;}
            .sidebar { position: absolute; width: 25%; height: 100%; top: 0; left: 0; overflow: hidden; border-right: 1px solid rgba(0, 0, 0, 0.33); }
            .heading { border-bottom: 1px solid #eee; min-height: 60px; line-height: 60px; padding: 0 10px; background-color: #00853e; color: #fff; }
            .listings { height: 100%; overflow: auto; padding-bottom: 60px; background-color: #eee;}
            .listings .item { border-bottom: 1px solid #000000; padding: 10px; text-decoration: none; }
            .listings .item:last-child { border-bottom: none; }
            .listings .item .title { display: block; color: #00853e; font-weight: 700; }
            .listings .item .title small { font-weight: 400; }
            .listings .item.active .title,
            .listings .item .title:hover { color: #8cc63f; }
            .listings .item.active { background-color: #f8f8f8; }
            ::-webkit-scrollbar { width: 3px; height: 3px; border-left: 0; background: rgba(0, 0, 0, 0.1); }
            ::-webkit-scrollbar-track { background: none }
            ::-webkit-scrollbar-thumb { background: #00853e; border-radius: 0; }
            .mapboxgl-popup-content { font: 400 15px/22px 'Source Sans Pro', 'Helvetica Neue', sans-serif; padding: 0; width: 300px; }
            .mapboxgl-popup-content h3 { background: #00853e; color: #fff; margin: 0; padding: 10px; border-radius: 3px 3px 0 0; font-weight: 700; margin-top: -15px; }
            .mapboxgl-popup-content h4 { margin: 0; padding: 10px; font-weight: 400; }
            .mapboxgl-popup-content div { padding: 10px; }
            .mapboxgl-popup-anchor-top > .mapboxgl-popup-content { margin-top: 15px; }
            .mapboxgl-popup-anchor-top > .mapboxgl-popup-tip { border-bottom-color: #00853e; }
        </style>
    </head>

    <body>

        <div id="map"></div>

        <div class="sidebar">

            <div class="heading">
                <h1 id="pagetitle">Eugene Music Venues</h1>
            </div>

            <div id="listings" class="listings">

            </div>

        </div>

        <script>
            //Basemap
            mapboxgl.accessToken = 'pk.eyJ1IjoiYWhvbG1hbjIiLCJhIjoiY2xnNWZqMTk3MDJydTNncXI2Zjdyb3lnNyJ9.7w1BY7r7Qbd3PAP9udXDnQ'
            var map = new mapboxgl.Map({
                container: 'map',
                style: 'mapbox://styles/mapbox/light-v11',
                center: [-123.0868,44.0521],
                zoom: 12,
                minZoom: 11.5,
                maxZoom: 15.5,
                
            });

            map.boxZoom.disable();
            map.dragRotate.disable();

           

            //Venues
            const venues = {
                "type": "FeatureCollection",
                "features": [
                                {
                                "type": "Feature",
                                "properties": {
                                    "name": "The Cuthbert Amphitheater",
                                    "type": "Amphitheater",
                                    "description": "Located in Alton Baker Park, the Cuthbert Amphitheater offers outdoor live music events featuring  both regional and touring acts.<br> <a href='https://thecuthbert.com'>thecuthbert.com</a>",
                                    "address": "2300 Leo Harris Pkwy, Eugene, OR 97401",
                                    "phone": "+1 541-762-8099",
                                },
                                "geometry": {
                                    "coordinates": [
                                    -123.075589,
                                    44.056035
                                    ],
                                "type": "Point",
                                }
                                },

                                {
                                "type": "Feature",
                                "properties": {
                                    "name": "The Spot",
                                    "type": "Concert Hall",
                                    "description": "Located on Main Street in Springfield, Or, The Spot (f.k.a. Hippie Museum) provides an all ages event space for both local and touring acts.",
                                    "address": "535 Main St, Springfield, OR 97477",
                                    "phone": "n/a",
                                },
                                "geometry": {
                                    "coordinates": [
                                    -123.018667,
                                    44.046004
                                    ],
                                    "type": "Point",
                                }
                                },

                                {
                                "type": "Feature",
                                "properties": {
                                    "name": "Matthew Knight Arena",
                                    "type": "Arena",
                                    "description": "While Matthew Knight Arena mainly serves as a venue for Sporting events, the Arena also hosts touring musicians and events, hosting some of the largest concerts in the region.<br> <a href='https://goducks.com/feature/mka'>goducks.com</a> ",
                                    "address": "1390 Villard St, Eugene, OR 97403",
                                    "phone": "+1 541-346-4461",
                                },
                                "geometry": {
                                    "coordinates": [
                                    -123.066311,
                                    44.044919
                                    ],
                                    "type": "Point",
                                }
                                },

                                {
                                "type": "Feature",
                                "properties": {
                                    "name": "Beall Concert Hall",
                                    "description": "Located on the University of Oregon's campus, Beall Concert Hall hosts both student and regional acts.<br> <a href='https://musicanddance.uoregon.edu'>musicanddance.uoregon.edu</a>",
                                    "type": "Concert Hall",
                                    "address": "961 E 18th Ave, Eugene, OR 97403",
                                    "phone": "n/a",
                                },
                                "geometry": {
                                    "coordinates": [
                                    -123.078341,
                                    44.040281
                                    ],
                                    "type": "Point",
                                }
                                },

                                {
                                "type": "Feature",
                                "properties": {
                                    "name": "Blairally Vintage Arcade",
                                    "type": "Bar",
                                    "description": "A Vintage 'Barcade' that hosts both local and touring acts, Blairally Vintage Arcade features a variety of vintage arcade games, as well as a full bar.<br> <a href='https://www.facebook.com/blairallyarcade'>facebook.com/blairallyarcade</a>",
                                    "address": "245 Blair Blvd, Eugene, OR 97402",
                                    "phone": "+1 541-683-1721",
                                },
                                "geometry": {
                                    "coordinates": [
                                    -123.110654,
                                    44.057149
                                    ],
                                    "type": "Point",
                                }
                                },

                                {
                                "type": "Feature",
                                "properties": {
                                    "name": "Slice | Pizzeria & Bar",
                                    "type": "Restaurant/Music Venue",
                                    "description": "A local independant pizza restaurant, Slice Pizzeria features a full bar and backyard complete with a covered stage, umbrellas, and seating to host both local and touring acts.<br> <a href='https://www.slicepizzeriabar.com/?utm_source=gbp'>slicepizzeriabar.com</a>",
                                    "address": "325 Blair Blvd, Eugene, OR 97402",
                                    "phone": "+1 541-653-9937",
                                },
                                "geometry": {
                                    "coordinates": [
                                    -123.109704,
                                    44.056256
                                    ],
                                    "type": "Point",
                                }
                                },

                                {
                                "type": "Feature",
                                "properties": {
                                    "name": "Sam Bond's Garage",
                                    "type": "Bar",
                                    "description": "Located in the Blair Historic District, Sam Bond's Garage features a full bar and menu featuring local ingredients, as well as a stage to host local and touring acts.<br> <a href='http://www.sambonds.com'>sambonds.com</a>",
                                    "address": "407 Blair Blvd, Eugene, OR 97402",
                                    "phone": "+1 541-431-6603",
                                },
                                "geometry": {
                                    "coordinates": [
                                    -123.108708,
                                    44.055245
                                    ],
                                    "type": "Point",
                                }
                                },

                                {
                                "type": "Feature",
                                "properties": {
                                    "name": "Alluvium",
                                    "type": "Event Space",
                                    "description": "A community space for a variety of events, Alluvium provdies a valuable platform for local and regional groups.<br> <a href='https://www.alluviumeugene.com'>alluviumeugene.com</a>",
                                    "address": "810 W 3rd Ave, Eugene, OR 97402",
                                    "phone": "n/a",
                                },
                                "geometry": {
                                    "coordinates": [
                                    -123.105197,
                                    44.056284
                                    ],
                                    "type": "Point",
                                }
                                },

                                {
                                "type": "Feature",
                                "properties": {
                                    "name": "Old Nick's Pub",
                                    "type": "Bar",
                                    "description": "Eugene's premier Victorian Gothic Pub, Old Nick's provides a unique atmosphere, full bar, and stage to host both local and touring acts.<br> <a href='https://www.oldnickspub.com'>www.oldnickspub.com</a>",
                                    "address": "211 Washington St, Eugene, OR 97401",
                                    "phone": "+1 541-844-1280",
                                },
                                "geometry": {
                                    "coordinates": [
                                    -123.100018,
                                    44.057423
                                    ],
                                    "type": "Point",
                                }
                                },

                                {
                                "type": "Feature",
                                "properties": {
                                    "name": "Hult Center for the Performing Arts",
                                    "type": "Concert Hall",
                                    "description": "Opened in 1982, the Hult Center for the Performing Arts features a 2,447 seat concert hall, 495 seat Soreng Theater, and stunning architecture.<br> <a href='https://hultcenter.org'>hultcenter.org</a>",
                                    "address": "1 Eugene Center, Eugene, OR 97401",
                                    "phone": "+1 541-682-5000",
                                },
                                "geometry": {
                                    "coordinates": [
                                    -123.093179,
                                    44.052743
                                    ],
                                    "type": "Point",
                                }
                                },

                                {
                                "type": "Feature",
                                "properties": {
                                    "name": "WOW Hall",
                                    "type": "Concert Hall",
                                    "description": "The historic Woodman of the World (W.O.W.) Hall is operated by the nonprofit Community Center for the Performing Arts, and largely run by volunteers. Along with serving as a venue for local and touring acts, WOW Hall also hosts community workshops, lectures, rehersals, and recording sessions.<br> <a href='http://www.wowhall.org'>wowhall.org</a>",
                                    "address": "291 W 8th Ave, Eugene, OR 97401",
                                    "phone": "+1 541-687-2746",
                                },
                                "geometry": {
                                    "coordinates": [
                                    -123.097083,
                                    44.051086
                                    ],
                                    "type": "Point",
                                }
                                },

                                {
                                "type": "Feature",
                                "properties": {
                                    "name": "The Big Dirty",
                                    "type": "Bar",
                                    "description": "The Big Dirty features wall to wall custom artwork, a dynamic LED lighting system, full bar, and engineered sound treatment to host both local and touring acts.<br> <a href='https://www.thebigdirty.live'>thebigdirty.live</a>",
                                    "address": "844 Olive St, Eugene, OR 97401",
                                    "phone": "+1 541-650-6634",
                                },
                                "geometry": {
                                    "coordinates": [
                                    -123.094573,
                                    44.050548
                                    ],
                                    "type": "Point",
                                }
                                },

                                {
                                "type": "Feature",
                                "properties": {
                                    "name": "The Jazz Station",
                                    "type": "Concert Hall",
                                    "description": "Located in downtown Eugene, the Jazz Station is one of Oregon's only Jazz clubs, which features a 70 seat room for student, local, and regional jazz performers.<br> <a href='https://thejazzstation.org/#!event-list'>thejazzstation.org</a>",
                                    "address": "124 W Broadway, Eugene, OR 97401",
                                    "phone": "+1 458-205-1030",
                                },
                                "geometry": {
                                    "coordinates": [
                                    -123.09483,
                                    44.0498
                                    ],
                                    "type": "Point",
                                }
                                },

                                {
                                "type": "Feature",
                                "properties": {
                                    "name": "Luckey's Club",
                                    "type": "Bar",
                                    "description": "One of the oldest bars in Oregon, Luckey's Club has rich history as a former Cigar store which originally opened in 1911. Today, the club preserves its unique history while still providing a popular downtown venue for both local and touring acts.<br> <a href='https://www.luckeysclub.com'>luckeysclub.com</a>",
                                    "address": "933 Olive St, Eugene, OR 97401",
                                    "phone": "+1 541-687-4643",
                                },
                                "geometry": {
                                    "coordinates": [
                                    -123.094055,
                                    44.04953
                                    ],
                                    "type": "Point",
                                }
                                },

                                {
                                "type": "Feature",
                                "properties": {
                                    "name": "John Henry's",
                                    "type": "Bar",
                                    "description": "Located in downtown Eugene, John Henry's features a full bar and stage to host both local and touring acts.<br> <ahref='https://www.johnhenrysbar.com'>johnhenrysbar.com</a>",
                                    "address": "881 Willamette St, Eugene, OR 97401",
                                    "phone": "+1 541-600-3994",
                                },
                                "geometry": {
                                    "coordinates": [
                                    -123.09238,
                                    44.050172
                                    ],
                                    "type": "Point",
                                }
                                },

                                {
                                "type": "Feature",
                                "properties": {
                                    "name": "McDonald Theatre",
                                    "type": "Concert Hall",
                                    "description": "Built in 1925, the McDonald Theatre is a historic landmark located in downtown Eugene. After the motion picture boom, the theatre was converted into a movie house which it operated as until 2000. It now hosts a diverse spectrum of events, including some of today's most popular touring acts.<br> <a href='https://mcdonaldtheatre.com'>mcdonaldtheatre.com</a> ",
                                    "address": "1010 Willamette St, Eugene, OR 97401",
                                    "phone": "+1 541-345-4442",
                                },
                                "geometry": {
                                    "coordinates": [
                                    -123.093055,
                                    44.048611
                                    ],
                                    "type": "Point",
                                }
                                },

                                {
                                "type": "Feature",
                                "properties": {
                                    "name": "The Shedd Institute",
                                    "type": "Concert Hall",
                                    "description": "The Shedd Institute hosts classes, workshops, private lessons, and a variety of other events for local music students.<br> <a href='https://theshedd.org'>theshedd.org</a> ",
                                    "address": "868 High St, Eugene, OR 97401",
                                    "phone": "+1 541-434-7000",
                                },
                                "geometry": {
                                    "coordinates": [
                                    -123.088522,
                                    44.050071
                                    ],
                                    "type": "Point",
                                }
                                },
                ]
            };

            // Assign Unique id to each venue (for sidebar list)
            venues.features.forEach(function (venue, i) {
                venue.properties.id = i;
                });

                map.on('load', () => {
                //add data to map as a new layer
                    map.addLayer({
                        id: 'locations',
                        type: 'circle',
                        
                        source: {
                        type: 'geojson',
                        data: venues
                        }
                    });
                //add data to sidebar
                    buildLocationList(venues);

            });
            
            map.on('click', (event) => {
                /* Determine if a feature in the "locations" layer exists at that point. */
                const features = map.queryRenderedFeatures(event.point, {
                    layers: ['locations']
                });

                /* If it does not exist, return */
                if (!features.length) return;

                const clickedPoint = features[0];

                /* Fly to the point */
                flyToVenue(clickedPoint);

                /* Close all other popups and display popup for clicked store */
                createPopUp(clickedPoint);

                /* Highlight listing in sidebar (and remove highlight for all other listings) */
                const activeItem = document.getElementsByClassName('active');
                if (activeItem[0]) {
                    activeItem[0].classList.remove('active');
                }
                const listing = document.getElementById(
                    `listing-${clickedPoint.properties.id}`
                );
                listing.classList.add('active');
            });

            function buildLocationList(venues) {
                for (const venue of venues.features) {
                    /* Add a new listing section to the sidebar. */
                    const listings = document.getElementById('listings');
                    const listing = listings.appendChild(document.createElement('div'));
                    /* Assign a unique `id` to the listing. */
                    listing.id = `listing-${venue.properties.id}`;
                    /* Assign the `item` class to each listing for styling. */
                    listing.className = 'item';

                    /* Add the link to the individual listing created above. */
                    const link = listing.appendChild(document.createElement('a'));
                    link.href = '#';
                    link.className = 'title';
                    link.id = `link-${venue.properties.id}`;
                    link.innerHTML = `${venue.properties.name}`;

                    //Add details to listings
                    const details = listing.appendChild(document.createElement('div'));
                    details.innerHTML = `${venue.properties.type}<br>`;
                    if (venue.properties.phone) {
                        details.innerHTML += ` &#9742 ${venue.properties.phone}<br>`;
                    }
                    if (venue.properties.address) {
                        details.innerHTML +=` &#10026 ${venue.properties.address}`;
                    }


                    //fly to venue when user clicks on sidebar
                    link.addEventListener('click', function () {
                        for (const feature of venues.features) {
                            if (this.id === `link-${feature.properties.id}`) {
                            flyToVenue(feature);
                            createPopUp(feature);
                            }
                        }
                        const activeItem = document.getElementsByClassName('active');
                        if (activeItem[0]) {
                            activeItem[0].classList.remove('active');
                        }
                        this.parentNode.classList.add('active');
                    });
                }
            }
            
            function flyToVenue(currentFeature) {
                map.flyTo({
                    center: currentFeature.geometry.coordinates,
                    zoom: 15
                });
            }
            //Check for and close current popups, then create new popup
            function createPopUp(currentFeature) {
                const popUps = document.getElementsByClassName('mapboxgl-popup');
                if (popUps[0]) popUps[0].remove();

                const popup = new mapboxgl.Popup({ closeOnClick: false })
                    .setLngLat(currentFeature.geometry.coordinates)
                    .setHTML(`<h3>${currentFeature.properties.name}</h3><h4>${currentFeature.properties.description}</h4><h4>&#9742 ${currentFeature.properties.phone}</h4><h4>&#10026 ${currentFeature.properties.address}</h4>`)
                    .addTo(map);
            }
            //Add event listener to title to reset map
            document.getElementById("pagetitle").addEventListener('click', function () {map.jumpTo({center: [-123.0868,44.0521], zoom: 12 });
            // Check for and close current popups
                const popUps = document.getElementsByClassName('mapboxgl-popup');
                    if (popUps[0]) popUps[0].remove();
            });
        </script>
    </body>

</html>